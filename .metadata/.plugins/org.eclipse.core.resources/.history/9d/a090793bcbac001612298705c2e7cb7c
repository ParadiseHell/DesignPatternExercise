package com.chengtao.receiver;

import com.chengtao.impl.UDPReceiverProtocol;

public class LineReceiver{
	private CharReceiver cr = null;
	private char[] charBuf = new char[10];
	private UDPReceiverProtocol protocol = null;
	
	public LineReceiver(CharReceiver cr){
		this.cr = cr;
	}
	
	public String receiveLine(){
		if (protocol == null) {
			throw new NullPointerException("没有设置UDP接受的协议");
		}
		resetBuffer();
		char ch;
		int i = 0;
		while(true){
			ch = cr.receive();
			if (ch != '\0' && ch != '0') {
				System.out.println(ch);
				if (ch == protocol.getLineChar() || ch == protocol.getEndChar()) {
					break;
				}
				charBuf[i] = ch;
				i++;
			}else {
				break;
			}
		}
		return new String(charBuf);
	}
	
	private void resetBuffer(){
		for (int i = 0; i < charBuf.length; i++) {
			charBuf[i] = '\0';
		}
	}
	
	public int receivePattern(String pattern){
		int partternNum = 0;
		String receiveString = null;
		while (true) {
			receiveString = receiveLine();
			if (receiveString == null) {
				break;
			}
			
		}
		return partternNum;
	}
	
	public static int matchPattern(String matrix, String pattern){
		String s[] = matrix.split(pattern);
		return s.length - 1;
	}

	public void setUDPReceiverProtocol(UDPReceiverProtocol protocol) {
		this.protocol = protocol;
	}
}
