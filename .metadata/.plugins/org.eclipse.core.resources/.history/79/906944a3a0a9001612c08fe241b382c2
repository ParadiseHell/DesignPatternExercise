package com.chengtao.base;

import com.chengtao.impl.BinomialIterator;

/**
 * 二项式分布概率类<br/>
 * 只针对概率为1/2，且成功次数为总次数的一半
 * 
 * @author ChengTao
 *
 */
public class Binomial implements BinomialIterator {
	private int upFontPos = 1;
	private int upBackPos = 1;
	private int belowFontPos = 1;
	private int belowBackPos = 1;
	private float testResult = 1;
	private float realResult = 1;
	private boolean useFont = false;

	public Binomial(int successNum) {
			upFontPos = successNum + 1;
			upBackPos = 2 * successNum;
			belowBackPos = successNum;
	}

	@Override
	public boolean hasNext() {
		return upFontPos <= upBackPos;
	}

	@Override
	public double next() {
		double result = 1;
		if (useFont) {
			if (upFontPos > 0) {
				testResult *= (double)upFontPos / (double)(belowFontPos * 4 );
				if (testResult > Double.MAX_VALUE) {
					useFont = false;
					
					realResult *= (double)upBackPos / (double)(belowBackPos * 4 );
					testResult = realResult;
					
					result = (double)upBackPos / (double)(belowBackPos * 4 );
					upBackPos--;
					belowBackPos--;
				}else {
					realResult = testResult;
					
					result = (double)upFontPos / (double)(belowFontPos * 4 );
					upFontPos++;
					belowFontPos++;
				}
			}
		}else {
			if (upBackPos > 0) {
				testResult *= (double)upBackPos / (double)(belowBackPos * 4 );
				if (testResult < Double.MIN_VALUE) {
					useFont = true;
					
					realResult *= (double)upFontPos / (double)(belowFontPos * 4 );
					testResult = realResult;
					
					result = (double)upFontPos / (double)(belowFontPos * 4 );
					
					upFontPos++;
					belowFontPos++;
				}else {
					realResult = testResult;
					
					result = (double)upBackPos / (double)(belowBackPos * 4 );
					upBackPos--;
					belowBackPos--;
				}
			}
		}
		return result;
	}
}
