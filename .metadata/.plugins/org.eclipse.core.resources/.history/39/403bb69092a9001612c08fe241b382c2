package com.chengtao.base;

import com.chengtao.impl.BinomialIterator;

/**
 * 二项式分布概率类<br/>
 * 只针对概率为1/2，且成功次数为总次数的一半
 * 
 * @author ChengTao
 *
 */
public class Binomial implements BinomialIterator {
	/*private int successNum;
	private int totalNum;*/
	private int upFontPos = 1;
	private int upBackPos = 1;
	private int belowFontPos = 1;
	private int belowBackPos = 1;

	public Binomial(int successNum) throws NumberToBigException {
		if (successNum <= Integer.MAX_VALUE / 2) {
			this.successNum = successNum;
			totalNum = 2 * successNum;
			upFontPos = successNum + 1;
			upBackPos = totalNum;
		} else {
			throw new NumberToBigException();
		}
	}

	@Override
	public boolean hasNext() {
		return upNum <= totalNum;
	}

	@Override
	public float next() {
		float result = 1;
		for (int i = upNum; i <= totalNum; i++) {
			upTestResult *= i;
			if (upTestResult < upResult) {
				upNum = i - 1;
				break;
			}
			upResult = upTestResult;
			upNum++;
		}
		for (int j = belowNum; j <= successNum; j++) {
			belowTestResult *= (j * 4);
			if (belowTestResult < belowResult ) {
				belowNum = j - 1;
				break;
			}
			belowResult = belowTestResult;
			belowNum++;
		}
		result = (float) upResult / (float) belowResult;
		reset();
		return result;
	}
	
	private void reset(){
		upResult = 1;
		upTestResult = 1;
		belowResult = 1;
		belowTestResult = 1;
	}
	
	private class NumberToBigException extends Exception {

		/**
		 * 
		 */
		private static final long serialVersionUID = 1483277992636961845L;

		@Override
		public void printStackTrace() {
			System.out.println("输入的数字太大了......");
		}

	}
}
